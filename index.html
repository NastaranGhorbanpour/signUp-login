<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="assets/style/output.css">
    <link rel="stylesheet" href="assets/font/footer-icons/css/fontello.css">
    <link rel="stylesheet" href="assets/font/css/fontello.css">
</head>

<body class="bg-[#CCCCCC] relative w-full min-h-[100vh] flex flex-wrap items-center justify-center">

    <section id="regForm" class="w-8/10  bg-[#3B3B3B] flex justify-between relative">
        <div class="w-1/2 h-full px-10 py-20 text-white ">
            <h2>Don't have an account?</h2>
            <p class="mt-5 mb-6">Banjo tote bag bicycle rights, High Life sartorial cray craft beer whatever street art
                fap.</p>
            <button id="moveLeft"
                class="border-1 border-white btn hover:bg-[#CCCCCC] hover:text-[#3B3B3B] duration-300">SING UP</button>
        </div>
        <div class="w-1/2 h-full p-10 py-20 text-white ">
            <h2>Have an account?</h2>
            <p class="mt-5 mb-6">Banjo tote bag bicycle rights, High Life sartorial cray craft beer whatever street art
                fap.</p>
            <button id="moveRight"
                class="border-1 border-white btn hover:bg-[#CCCCCC] hover:text-[#3B3B3B] duration-300">LOGIN</button>
        </div>

        <section id="form"
            class=" min-h-[470px] *:px-10 py-15 absolute w-1/2 rounded-sm shadow-2xl left-[25px] top-[20px] md:-top-[60px] bg-white ">
            <div id="signUp" class="turn">
                <h3 class="w-full  my-5 text-green-500 text-lg  "></h3>

                <h2 class="w-full text-[#E7716D] text-3xl uppercase">sign up</h2>
                <div class="w-full relative">
                    <input class="inp" type="text" placeholder="Full Name" required>
                    <span class="alert absolute -bottom-2 left-0"></span>
                </div>

                <div class="w-full relative">
                    <input class="inp" type="text" placeholder="Email" required>
                    <span class="alert absolute -bottom-2 left-0"></span>
                </div>

                <div class="w-full relative">
                    <input class="inp" type="text" placeholder="Password" required>
                    <span class="alert absolute -bottom-2 left-0"></span>
                </div>




                <button id="signUpBtn" class="btn bg-[#E7716D] hover:bg-[#ae4c4c] mt-5 ">sign up</button>
            </div>

            <div id="login" class="hidden">
                <h3 class="w-full  my-5 text-green-500 text-lg  "></h3>

                <h2 class="w-full text-[#E7716D] text-3xl uppercase mb-5">LOGIN</h2>

                <div class="w-full relative">
                    <input class="inp" type="text" placeholder="Email" required>
                    <span class="alert absolute -bottom-2 left-0"></span>
                </div>

                <div class="w-full relative">
                    <input class="inp" type="text" placeholder="Password" required>
                    <span class="alert absolute -bottom-7 md:-bottom-3 left-0"></span>
                </div>

                <span class="text-[#E7716D] cursor-pointer  text-xl w-full flex flex-wrap justify-end mt-3"
                    href="">Admin Page</span>



                <button id="loginBtn" class="btn bg-[#E7716D] hover:bg-[#ae4c4c] mt-10 ">login</button>
            </div>
        </section>
    </section>

    <section id="infoForm" class="w-9/10 bg-[#3B3B3B] hidden flex-wrap justify-center items-center p-10">
        <section class="relative w-full bg-white flex flex-wrap justify-center py-5 ">
            <section class="formInfo *:text-[#E7716D] *:text-xl">
                <span>ID</span>
                <span>Name</span>
                <span>Email</span>
                <span>Password</span>
                <span>Actions</span>
            </section>

            <section id="updateBox"
                class=" w-1/2 p-5 hidden absolute top-1/3 left-1/4 flex-wrap justify-center rounded-lg shadow-2xl shadow-black bg-[#3B3B3B]  *:rounded-sm ">
                <h2 class="text-white ">Update List</h2>
                <input class="editInp" type="text">
                <input class="editInp" type="text">
                <input class="editInp" type="text">
                <button onclick="sendEdit()"
                    class="btn border-[#7b7979] border-1 hover:bg-white hover:text-black duration-300">Update</button>
            </section>

            

        </section>
        <button class="btn mt-10 border-1 border-[btn] p-3 hover:bg-white hover:text-black ">Back to login page</button>


    </section>

    <figure class="group z-50 w-[150px] h-[150px] absolute bottom-[40px] left-[25px] ">


        <img class="w-full h-full object-cover absolute top-0 left-0 firstAnime z-50" src="assets/img/me.JPG" alt="">

        <figcaption class="font-[caveat] absolute -bottom-[25px] left-0 text-[18px] text-[rgb(148, 87, 67)]">Nastaran
            Ghorbanpour</figcaption>

        <a href="https://github.com/NastaranGhorbanpour"
            class="icon-github-circled decoration-0 w-[15px] h-[15px] absolute right-[40%] text-[20px] -z-10 duration-1000 text-[rgb(85, 57, 21)] hover:text-[rgb(148, 87, 67)] bottom-[20px] group-hover:-right-[20%] group-hover:z-50"></a>
        <a href="https://www.linkedin.com/in/nastaran-ghorbanpour-027a7b349/"
            class="icon-linkedin decoration-0 w-[15px] h-[15px] absolute right-[40%] text-[20px] -z-10 duration-1000 text-[rgb(85, 57, 21)] hover:text-[rgb(148, 87, 67)] bottom-[70px] group-hover:-right-[20%] group-hover:z-50"></a>
        <a href="https://www.instagram.com/nestacode.lab/"
            class="icon-instagram decoration-0 w-[15px] h-[15px] absolute right-[40%] text-[20px] -z-10 duration-1000 text-[rgb(85, 57, 21)] hover:text-[rgb(148, 87, 67)] bottom-[120px] group-hover:-right-[20%] group-hover:z-50"></a>
    </figure>

</body>
<script>
    const myUrl = 'https://686a987ee559eba9087069db.mockapi.io/login'

    const moveLeft = document.getElementById('moveLeft')
    const moveRight = document.getElementById('moveRight')

    const form = document.getElementById('form')
    const loginBtn = document.getElementById('loginBtn')
    const signUpBtn = document.getElementById('signUpBtn')

    const inpSignUp = document.querySelectorAll('#signUp>div>input')
    const inpLogin = document.querySelectorAll('#login>div>input')
    const adminPage = document.querySelector('#login>span')

    const respond = document.querySelectorAll('#form>div>h3')

    const adminAccess = document.getElementById('adminAccess')
    const regForm = document.getElementById('regForm')
    const infoForm = document.getElementById('infoForm')
    const innerInfoForm = document.querySelector('#infoForm>section')
    const backToLogin = document.querySelector('#infoForm>button')

    const updateBox = document.getElementById('updateBox')
    const updateInp = document.querySelectorAll('#updateBox>input')


    const info = {
        fullName: '',
        email: '',
        password: ''

    }


    moveLeft.addEventListener('click', () => {
        form.classList.remove('right-[25px]')
        form.classList.add('left-[25px]')
        form.children[0].classList.replace('hidden', 'turn')
        form.children[1].classList.replace('turn', 'hidden')
        loginReset()
    })
    moveRight.addEventListener('click', () => {
        form.classList.remove('left-[25px]')
        form.classList.add('right-[25px]')
        form.children[0].classList.replace('turn', 'hidden')
        form.children[1].classList.replace('hidden', 'turn')
        singUpReset()
    })

    signUpBtn.addEventListener('click', () => {
        let full = true
        inpSignUp.forEach((val) => {
            if (val.value == '') {
                val.style.borderBottom = '1px solid red'
                val.style.color = 'red'
                val.nextElementSibling.innerHTML = 'Pleas Fill Out This Field'
                full = false
                console.log('not full');

            } else {
                val.style.borderBottom = '1px solid #7b7979'
                val.style.color = '#7b7979'
                val.nextElementSibling.innerHTML = ''

            }

        })
        if (full) {

            info.fullName = inpSignUp[0].value
            validateEmailFormat()
            checkPasswordRules()


            let counter = 0
            Object.keys(info).map((val) => {
                if (info[val] == '') {
                    counter++
                }

            })

            if (counter == 0) {
                let checked = checkEmailExists()

                if (checked = true) {
                    fetch(myUrl, {
                        method: 'POST',
                        headers: { 'content-type': 'application/json' },
                        body: JSON.stringify(info)
                    }).then(res => {
                        if (res.ok) return res.json();
                        throw new Error('err')

                    }).then(task => {
                        respond[0].innerHTML = 'Your account has been created successfully.'


                    }).catch((error) => console.log('an error eccured!')
                    )
                } else {
                    alert('this email alredy exict')
                }

            }



        }
    })

    function validateEmailFormat() {
        const emailRejex = /^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/;

        if (!emailRejex.test(inpSignUp[1].value)) {
            inpSignUp[1].nextElementSibling.innerHTML = 'Pleas Enter The Correct Email Format'
        } else {
            inpSignUp[1].nextElementSibling.innerHTML = ''
            info.email = inpSignUp[1].value
        }
    }

    function checkPasswordRules() {
        const passRejex = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/;

        if (!passRejex.test(inpSignUp[2].value)) {
            let pass = inpSignUp[2].value
            let span = inpSignUp[2].nextElementSibling


            if (pass.length < 8) {
                span.innerHTML = 'At least 8 characters long'
            } else if (!/[A-Z]/.test(pass)) {
                span.innerHTML = 'At least one uppercase letter (A–Z)'
            } else if (!/[a-z]/.test(pass)) {
                span.innerHTML = 'At least one lowercase letter (a–z)'
            } else if (!/\d/.test(pass)) {
                span.innerHTML = 'At least one number (0–9)'
            }



        } else {
            inpSignUp[2].nextElementSibling.innerHTML = ''
            info.password = inpSignUp[2].value

        }
    }

    function checkEmailExists() {
        let status = 0
        fetch(myUrl)
            .then(res => {
                if (res.ok) return res.json()
                throw new Error('err')
            })
            .then(data => {
                data.map((val) => {
                    if (val.email == info.email) {
                        status++
                    }
                })

                if (status == 0) {
                    return true
                } else {
                    return false
                }


            })
            .catch((err) => console.log(err)
            )
    }

    let user = ''

    adminPage.addEventListener('click', () => {
        inpLogin[0].value = 'nastaran@gmail.com'
        inpLogin[1].value = 'Nas12345'
    })

    backToLogin.addEventListener('click' , ()=>{
        regForm.style.display = 'flex'
        infoForm.style.display = 'none'
    })

    loginBtn.addEventListener('click', () => {
        let full = true


        inpLogin.forEach((val) => {
            if (val.value == '') {
                val.style.borderBottom = '1px solid red'
                val.style.color = 'red'
                val.nextElementSibling.innerHTML = 'Pleas Fill Out This Field'
                full = false
            } else {
                val.style.borderBottom = '1px solid #7b7979'
                val.style.color = '#7b7979'
                val.nextElementSibling.innerHTML = ''

            }
        })

        if (full) {
            fetch(myUrl)
                .then(res => {
                    if (res.ok) return res.json()
                    throw new Error('err')
                })
                .then(data => {
                    let mailcheck = true
                    data.map((val) => {
                        if (val.email == inpLogin[0].value) {
                            mailcheck = false

                            if (val.password == inpLogin[1].value) {

                                regForm.style.display = 'none'
                                infoForm.style.display = 'flex'
                                if (val.id == 1) {
                                    user = 'admin'
                                    setAdminData()
                                } else {
                                    setUserData(val)
                                }
                            } else {
                                inpLogin[1].nextElementSibling.innerHTML = 'Your email and password do not match'
                            }
                        }})

                    if (mailcheck) {
                        inpLogin[0].nextElementSibling.innerHTML = 'This email is not registered in our system'
                    }
                })
                .catch((err) => console.log(err)
                )}})

    function setUserData(val) {
        let newDiv = document.createElement('div')
        newDiv.innerHTML = `
            <span>${val.id}</span>
            <span>${val.fullName}</span>
            <span>${val.email}</span>
            <span>${val.password}</span>
            <span><i onclick='myDel(${val.id})' class="icon-trash icons"></i><i onclick='myUpdate(${val.id})' class="icon-pencil icons"></i></span>
            `
        newDiv.classList.add('formInfo')
        innerInfoForm.appendChild(newDiv)
    }

    function setAdminData() {
        fetch(myUrl, {
            method: 'GET',
            headers: { 'content-type': 'application/json' },
        })
            .then(res => {
                if (res.ok) return res.json()
                throw new Error('err')
            })
            .then(data => {
                data.map((val) => {
                    let newDiv = document.createElement('div')
                    if(val.id == 1){
                        newDiv.innerHTML = `
                        <span>${val.id}</span>
                        <span>${val.fullName}</span>
                        <span>${val.email}</span>
                        <span>${val.password}</span>
                        <span>ADMIN</span>
                        `
                    }else{
                        newDiv.innerHTML = `
                        <span>${val.id}</span>
                        <span>${val.fullName}</span>
                        <span>${val.email}</span>
                        <span>${val.password}</span>
                        <span><i onclick='myDel(${val.id})' class="icon-trash icons"></i><i onclick='myUpdate(${val.id})' class="icon-pencil icons"></i></span>

                        `

                    }
                    
                    newDiv.classList.add('formInfo')
                    innerInfoForm.appendChild(newDiv)

                })

            })
            .catch((err) => console.log(err)
            )

    }

    function myUpdate(id) {
        
        updateBox.style.display = 'flex'
        updateBox.setAttribute('data-i', id)

        fetch(myUrl + '/' + id)
            .then(res => {
                if (res.ok) return res.json()
                throw new Error('err')
            })
            .then(data => {
                updateInp[0].value = data.fullName
                updateInp[1].value = data.email
                updateInp[2].value = data.password
            })
    }

    function sendEdit() {
        let id = updateBox.getAttribute('data-i')
        updateBox.style.visibility = 'hidden'

        const temp = {
            fullName: updateInp[0].value,
            email: updateInp[1].value,
            password: updateInp[2].value
        }

        fetch(myUrl + '/' + id, {
            method: 'PUT',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify(temp)
        }).then(res => {
            if (res.ok) {
                return res.json();
            }
            throw new Error('err')
        }).then(task => {
            alert('done!')
            const divs = document.querySelectorAll('#infoForm>section>div')
            divs.forEach((val) => {
                val.remove()
            })

            if (user == 'admin') {
                setAdminData()
            } else {
                fetch(myUrl + '/' + id)
                    .then(res => res.json())
                    .then(data => {
                        setUserData(data)
                    })}
        }).catch(error => {
            console.log(err);
        })
    }

    function myDel(id) {
        if (confirm('Are you sure?')) {
            fetch(myUrl + '/' + id, {
                method: 'DELETE',
            }).then(res => {
                if (res.ok) {
                    return res.json();
                }
            }).then(task => {
                alert('user by id : ' + id + ' was deleted!')
                if (user == 'admin') {
                    const divs = document.querySelectorAll('#infoForm>section>div')
                    divs.forEach((val) => {
                        val.remove()
                    })
                    setAdminData()
                } else {
                    regForm.style.display = 'flex'
                    infoForm.style.display = 'none'
                }
            }).catch(error => {
                console.log(error);
            })
        }
    }

    function loginReset() {
        respond[1].innerHTML = ''
        inpLogin[0].value = null
        inpLogin[0].nextElementSibling.innerHTML = null
        inpLogin[1].value = null
        inpLogin[1].nextElementSibling.innerHTML = null
    }

    function singUpReset() {
        respond[0].innerHTML = ''
        inpSignUp[0].value = null
        inpSignUp[0].nextElementSibling.innerHTML = ''
        inpSignUp[1].value = null
        inpSignUp[1].nextElementSibling.innerHTML = ''
        inpSignUp[2].value = null
        inpSignUp[2].nextElementSibling.innerHTML = ''
    }


</script>

</html>